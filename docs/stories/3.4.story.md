# Story 3.4: Metadata Management

## Status
Draft

## Story
As a data steward, I want comprehensive metadata management (extraction, glossary, lineage, quality, search) so that governance and discovery are effective.

## Scope
- In-scope: Automated extraction, lineage DAG, glossary, data quality metrics, impact analysis, search, API, UIs.
- Out-of-scope: External data catalogs (future integrations).

## Acceptance Criteria (Given/When/Then)
1) Extraction
- Given connected sources
- When extraction runs (daily)
- Then schemas, tables, columns, types, constraints, and basic profiles are stored

2) Lineage
- Given ETL jobs and queries
- When lineage is computed
- Then a DAG shows source→transform→destination with edge metadata

3) Glossary
- Given terms and relationships
- When I create/update terms
- Then definitions, synonyms, owners, and links to assets are managed

4) Data Quality
- Given metrics rules
- When evaluated
- Then completeness/accuracy/consistency/timeliness scores are computed and trended

5) Impact Analysis
- Given a schema change
- When analyzed
- Then downstream impacted assets (dashboards, queries, MVs) are listed

6) Search & Discovery
- Given indexed metadata
- When I search
- Then results across tables/columns/dashboards/terms are ranked and facetable

## Data Model / Migrations
- metadata_assets(id, type, name, owner_id, tags[], attrs jsonb)
- metadata_lineage(id, src_asset_id, dst_asset_id, edge jsonb)
- glossary_terms(id, term, definition, synonyms[], owner_id, related_terms[])
- data_quality_metrics(id, asset_id, metric, value, at)
- impact_records(id, change_ref, impacted_asset_id, details jsonb, at)
- search_index(id, asset_id, tokens tsvector)

## APIs
- /api/v1/metadata/assets [GET/POST]
- /api/v1/metadata/lineage/:assetId [GET]
- /api/v1/glossary [CRUD]
- /api/v1/data-quality [GET]
- /api/v1/impact [POST analyze]
- /api/v1/search?query=

## Processing
- ExtractionService pulls schemas + profiles
- LineageService parses SQL and ETL DAGs
- QualityService computes metrics on schedule
- SearchService updates tokens via triggers/jobs

## Security
- Respect RBAC on asset visibility; redact sensitive attributes

## Observability
- Metrics: extract.duration, lineage.nodes/edges, search.qps, quality.jobs

## Performance
- Indexing latency < 5m; lineage compute < 10m for 10k edges

## Rollout/Backout
- Feature flags by module; backout by disabling module cron

## Risks & Mitigations
- R: SQL parse errors -> M: fallback to manual lineage annotations
- R: Search bloat -> M: retention policies, archive rarely used assets

## UX/Design
- Metadata Explorer page; LineageVisualization component; GlossaryManager; Quality Dashboard

## Testing Strategy
- Unit: SQL parser, tokenization
- Integration: extraction on sample DBs; search queries
- E2E: browse assets, lineage view, glossary editing

## Tasks / Subtasks
1. Data model + extraction jobs
2. Lineage compute + DAG UI
3. Glossary CRUD + links
4. Quality metrics + dashboards
5. Search indexing + API
6. Tests + docs

## NFRs
- Security: RBAC enforcement, redaction
- Reliability: job retries with backoff

## DoD
- [ ] Extraction + lineage + glossary + search functional
- [ ] Quality metrics populated and visible
- [ ] Tests >= 80%

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-05 | 2.0 | Regenerated with exhaustive spec | Bob |

## Dev Agent Record
(To be filled by Dev)

## QA Results
(To be filled by QA)

