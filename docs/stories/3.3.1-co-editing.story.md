# Story 3.3.1: Co-editing (OT/CRDT)

## Status
Planned (deferred from Story 3.3)

## Story
As an editor, I want real-time co-editing on dashboards so multiple users can safely edit concurrently without conflicts.

## Scope
- Introduce an Operational Transform (OT) or CRDT-based co-editing core
- Cursor presence, selection ranges, field-level locking where appropriate
- Reconciliation with server-side validation and RBAC

## Acceptance Criteria
1) Concurrent Edits
- Given two editors editing the same text/JSON field
- When both make changes concurrently
- Then consistency is preserved and both eventually converge to the same state (no data loss)

2) Conflict Semantics
- Given overlapping edits
- When changes occur within the same region
- Then the chosen algorithm (OT/CRDT) resolves deterministically with predictable semantics documented

3) Presence
- Given multiple editors connected
- When they move cursors or select ranges
- Then other editors see cursor/selection presence in near-real time (<300ms)

## Non-Functional Requirements
- Latency < 300ms for co-edit operations
- Offline-tolerant reconciliation (optional stretch)
- Security: all ops authenticated/authorized; rate limiting

## Risks & Mitigations
- Algorithm complexity -> Prototype with proven library first (e.g., Yjs/Automerge/ShareDB)
- Data model compatibility -> Start with a constrained scope (specific fields) and expand

## Tasks
1. Evaluate and select OT/CRDT library (spike)
2. Implement collaboration service for ops (server)
3. WS message schema for co-edit ops + presence
4. Persistence and version checkpoints (rollback safety)
5. Frontend adapters/hooks for selected library
6. Tests: unit (ops), integration (apply/replay), E2E (two-client co-edit)

## DoD
- [ ] Library selected with rationale and POC
- [ ] Server co-edit ops implemented and tested
- [ ] Frontend adapter integrated with demo field(s)
- [ ] E2E two-client co-edit scenario passing
- [ ] Docs updated with conflict semantics and troubleshooting

